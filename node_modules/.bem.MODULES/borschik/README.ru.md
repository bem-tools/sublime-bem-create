# Borschik

Borschik — это расширяемый сборщик файлов текстовых форматов.
Его основной задачей является сборка статических файлов веб-проектов (CSS, JS
и т.д.).

[Статья про Borschik на bem.info](http://ru.bem.info/articles/borschik/)

## Основная функциональность

### Ссылки (link)

TODO

### Вставки (include)

TODO

## Минимизация CSS и JS

По умолчанию `borschik` минимизирует CSS (посредством [CSSO](https://github.com/css/csso))
и JS ([UglifyJS](https://github.com/mishoo/UglifyJS)).

Опция `--minimize no` выключает эту минимизацию.

## Относительные ссылки на картинки

Упоминание картинок в CSS файлах можно изменить с относительных путей на
абсолютные (или другие относительные) с помощью конфига (файл `.borschik`
в любой директории). Конфиг считается относящимся к той директории, в которой
он находится. Конфиги в директории более верхнего уровня (ближе к корню
проекта) важнее конфигов в директории более нижнего. Пример синтаксиса:

```js
    {
        "paths" : {
            "./": "/",
            "css/": "//mysite.st/test/css/"
        }
    }
```

Находяcь в корне проекта, приведённый пример делает так, что все файлы в
корне и ниже будут приводиться к абсолютному в пределах домена пути, а файлы
в директории `css/` к полному пути до `//mysite.st/test/css/`.

Например, если в проекте будет файл `css/my.css`, в котором написано
`background-image: url(../a/b.gif);` (относительная ссылка на картинку), то
из-за мапинга в `.borschik` про `"./": "/"` в результате будет
`background-image: url("/a/b.gif");`.

## «Заморозка» картинок

Для максимально эффективного использования кеширования картинки могут раздаваться
с заголовками, смысл которых «никогда больше не запрашивать». Чтобы инвалидировать
такой кеш, нужно менять путь к картинке. «Заморозка» картинок позволяет изменять
путь к картинке автоматически на основании хеш-суммы от её содержания.

Например, в вашей директории находится картинка `test.png`, файл `a.css` с текстом

```css
    a {
        p: url(test.png);
    }
```
и конфиг `.borschik` с текстом

```js
{
    "freeze_paths" : {
        "./": "a/b/"
    }
}
```
При запуске `borschik -i a.css -t css` вы получите следующий результат:

* Если не было, появится директория `./a/b`, в которой будет файл
`wFPs-e1B3wMRud8TzGw7YHjS08I.png` (имя будет меняться в зависимости от
содержимого картинки).
* Путь к картинке в CSS изменится следующим образом:

    ```css
    a {
        p: url("a/b/wFPs-e1B3wMRud8TzGw7YHjS08I.png");
    }
    ```

По умолчанию `borschik` при каждом упоминании картинки в
CSS-файле заменяет его на имя, основанное на хеш-сумме, если путь картинки попадает под
конфиг `borschik`. В конфиге `.borschik` предусмотрена секция `freeze_paths`, которая
задаёт соответствие между папкой, картинки в которой нужно так обрабатывать, и папкой,
куда складывать файлы картинок с изменённым именем.

Опция `--freeze no` выключает заморозку.

## Раскрытие символических ссылок  

В конфиге можно использовать ключ `follow_symlinks`, например:

```js
    "follow_symlinks" : {
        "./a/b/c.css" : true,
        "./a" : true
    }
```

Семантика такая: указываются те файлы/папки, при обработке относительных путей
от которых нужно проследовать по симлинке.
